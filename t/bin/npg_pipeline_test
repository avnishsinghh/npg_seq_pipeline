#!/usr/bin/env perl

use strict;
use warnings;
use Log::Log4perl qw(:levels);
use FindBin qw($Bin);
use lib ( -d "$Bin/../lib/perl5" ? "$Bin/../lib/perl5" : "$Bin/../lib" );
use lib ("$Bin/../t/lib");

use npg_pipeline::pluggable::central;

my $pipeline = npg_pipeline::pluggable::central->new_with_options();

my $level   = $pipeline->verbose() ? $DEBUG : $INFO;
my $logfile = $pipeline->log_file_path();
print {*STDERR} "Pipeline log file: ${logfile}\n";
my $layout = '%d %-5p %c - %m%n';
Log::Log4perl->easy_init({
    layout => $layout,
    level  => $level,
    file   => $logfile,
    utf8   => 1
});

# Inject adapter config for a test function to run in the pipeline
$pipeline->_registry->_registry()->{test_function} = {
  'function::test_function' => 'test_run'
};
# Run test pipeline
$pipeline->redirect_stderr();
$pipeline->main();

0;